{% extends "base.html" %}

{% load jstemplate %}
{% load i18n %}
{% load url from future %}
{% load shareabouts_utils %}

{% block load_early %}
{% endblock load_early %}

{% block header %}
{% endblock header %}

{% block content %}
  {% handlebarsjs '(.*)' %}

  <div id="content" class="container">
  </div>
{% endblock content %}

{% block load_late %}
  <script src="{{ STATIC_URL }}surveyor/app.js"></script>

  <script>
    (function(S) {

      // Initialise the templates
      var placeListSource = $('#place-list-tpl').html(),
          placeFormSource = $('#place-form-tpl').html(),
          placeItemSource = $('#place-item-tpl').html();

      Handlebars.registerPartial('place-item-tpl', placeItemSource);
      S.placeListTemplate = Handlebars.compile(placeListSource);
      S.placeFormTemplate = Handlebars.compile(placeFormSource);

      // Create our place collection
      S.placeCollection = new Shareabouts.PlaceCollection();

      // Create the router
      S.router = new S.Router();

      // Create the list view
      S.placeListView = new S.PlaceListView({
        collection: S.placeCollection,
        template: S.placeListTemplate,
        el: '#content'
      });

    }(Surveyor));

    Backbone.history.start({pushState: true});
  </script>
{% endblock load_late %}
