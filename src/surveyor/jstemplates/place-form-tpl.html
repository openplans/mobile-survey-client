{{#withCurrentUser}}
<div class="address-list">

  <form class="place-form">
    <fieldset>
      <legend>{{ place.address }}</legend>

      <input type="hidden" name="visible" value="on">

      {{#each survey_config.items}}

        <div class="survey-field survey-field-{{ name }}"{{#condition}} data-condition-field="{{ field }}" data-condition-value="{{ value }}"{{/condition}}>

          <label class="survey-label survey-label-{{ name }}" for="survey-{{ name }}">
            {{#_}}{{ prompt }}{{# optional }} (optional){{/ optional }}{{/_}}
          </label>

          <div class="survey-widgets survey-widgets-{{ name }}">
            {{#isInput}}
            <input id="survey-{{ name }}" class="survey-input" name="{{ name }}" type="{{ type }}" {{#attrs}} {{ key }}="{{ value }}"{{/attrs}} value="{{value}}">
            {{/isInput}}

            {{#isTextarea}}
            <textarea id="survey-{{ name }}" class="survey-input" name="{{ name }}"{{#attrs}} {{ key }}="{{ value }}"{{/attrs}} value="{{value}}"></textarea>
            {{/isTextarea}}

            {{#isSelect}}
            <select id="survey-{{ name }}" class="survey-input" name="{{ name }}" type="{{ type }}" {{#attrs}} {{ key }}="{{ value }}"{{/attrs}}>
              {{#select value}}
              {{#options}}
                <option value="{{value}}">{{label}}</option>
              {{/options}}
              {{/select}}
            </select>
            {{/isSelect}}

            {{#isFile}}
            <span class="fileinput-container {{^is_fileinput_supported}}disabled{{/is_fileinput_supported}}">
              <span>{{ inputfile_label }}</span>
              <input id="place-{{ name }}" class="survey-input" name="{{ name }}" type="{{ type }}" {{#attrs}} {{ key }}="{{ value }}"{{/attrs}}>
            </span>

            <span class="fileinput-name">
              {{^isFileInputSupported}}Sorry, your browser doesn't support file uploads.{{/isFileInputSupported}}
            </span>
            {{/isFile}}
          </div>
        </div>

      {{/each}}

    </fieldset>

    <hr>

    <fieldset>
      <label>Your name:</label>
      <input type="text" class="survey-input" name="submitter_name" {{#if current_user}}value="{{current_user}}"{{/if}} required="required">
    </fieldset>

    <hr>

    <div class="form-actions">
      <button type="button" class="btn discard-btn">{{#_}}Discard{{/_}}</button>
      <button type="submit" class="btn btn-primary save-btn">{{#_}}Save{{/_}}</button>

      <div class="survey-save-inprogress alert mini-alert pull-right alert-info"><span class="save-spinner-wrapper"></span> {{#_}}Saving{{/_}}</div>
      <div class="survey-save-success    alert mini-alert pull-right alert-success">{{#_}}Saved{{/_}}</div>

      <div class="survey-save-error modal hide fade">
        <div class="modal-body">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
          <p>{{#_}}There was a problem saving the survey for {{place.address}}. Please try again in a few minutes.{{/_}}</p>
        </div>
      </div>
    </div>
  </form>
</div>

<div class="discard-confirmation modal hide fade">
  <div class="modal-body">
    <p>You have made changes. Are you sure you want to discard them?</p>
  </div>
  <div class="modal-footer">
    <button class="btn yes-btn">Yes</button>
    <button class="btn btn-primary no-btn" data-dismiss="modal">No</button>
  </div>
</div>

<div class="modal hide fade" id="save-changes-prompt">
  <div class="modal-body">
    <p>You have made changes. Do you want to save them before leaving?</p>
  </div>
  <div class="modal-footer">
    <a href="place-list.html" class="btn">No, discard</a>
    <a href="place-list.html" class="btn btn-primary">Yes, save</a>
  </div>
</div>
{{/withCurrentUser}}
